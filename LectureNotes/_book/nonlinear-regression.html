<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 4 NonLinear Regression | Econometrics of Policy Evaluation</title>
  <meta name="description" content="ECON 474 R-lab notes" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content=" 4 NonLinear Regression | Econometrics of Policy Evaluation" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://guerramarcelino.github.io/Econ474/474-Rlabs/" />
  
  <meta property="og:description" content="ECON 474 R-lab notes" />
  <meta name="github-repo" content="guerramarcelino/474-Rlab" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 4 NonLinear Regression | Econometrics of Policy Evaluation" />
  
  <meta name="twitter:description" content="ECON 474 R-lab notes" />
  

<meta name="author" content="Ben Cizek, Alex Costa, Marcelino Guerra, Mingqian Liu" />


<meta name="date" content="2022-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="subclassification-and-matching.html"/>
<link rel="next" href="instrumental-variables.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECON 474 @UIUC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html"><i class="fa fa-check"></i><b>1</b> RAND Health Insurance Experiment</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html#working-with-.rds-files"><i class="fa fa-check"></i><b>1.1</b> Working with .RDS files</a></li>
<li class="chapter" data-level="1.2" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html#summarizing-data"><i class="fa fa-check"></i><b>1.2</b> Summarizing data</a></li>
<li class="chapter" data-level="1.3" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html#checking-for-balance"><i class="fa fa-check"></i><b>1.3</b> Checking for Balance</a></li>
<li class="chapter" data-level="1.4" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html#results-of-the-experiment"><i class="fa fa-check"></i><b>1.4</b> Results of the Experiment</a></li>
<li class="chapter" data-level="1.5" data-path="rand-health-insurance-experiment.html"><a href="rand-health-insurance-experiment.html#equivalence-of-differences-in-means-and-regression"><i class="fa fa-check"></i><b>1.5</b> Equivalence of Differences in Means and Regression</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="inference-review.html"><a href="inference-review.html"><i class="fa fa-check"></i><b>2</b> Inference Review</a>
<ul>
<li class="chapter" data-level="2.1" data-path="inference-review.html"><a href="inference-review.html#flipping-coins"><i class="fa fa-check"></i><b>2.1</b> Flipping coins</a></li>
<li class="chapter" data-level="2.2" data-path="inference-review.html"><a href="inference-review.html#sample-mean"><i class="fa fa-check"></i><b>2.2</b> Sample mean</a></li>
<li class="chapter" data-level="2.3" data-path="inference-review.html"><a href="inference-review.html#measuring-variability"><i class="fa fa-check"></i><b>2.3</b> Measuring Variability</a></li>
<li class="chapter" data-level="2.4" data-path="inference-review.html"><a href="inference-review.html#central-limit-theorem-clt"><i class="fa fa-check"></i><b>2.4</b> Central Limit Theorem (CLT)</a></li>
<li class="chapter" data-level="2.5" data-path="inference-review.html"><a href="inference-review.html#the-t-statistic-and-the-clt"><i class="fa fa-check"></i><b>2.5</b> The t-Statistic and the CLT</a></li>
<li class="chapter" data-level="2.6" data-path="inference-review.html"><a href="inference-review.html#confidence-interval"><i class="fa fa-check"></i><b>2.6</b> Confidence Interval</a></li>
<li class="chapter" data-level="2.7" data-path="inference-review.html"><a href="inference-review.html#hypothesis-testing"><i class="fa fa-check"></i><b>2.7</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html"><i class="fa fa-check"></i><b>3</b> Subclassification and Matching</a>
<ul>
<li class="chapter" data-level="3.1" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#subclassification-example"><i class="fa fa-check"></i><b>3.1</b> Subclassification Example</a></li>
<li class="chapter" data-level="3.2" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#propensity-score-example"><i class="fa fa-check"></i><b>3.2</b> Propensity Score Example</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#nearest-neighbor-matching"><i class="fa fa-check"></i><b>3.2.1</b> Nearest-Neighbor Matching</a></li>
<li class="chapter" data-level="3.2.2" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#weighting-on-the-propensity-score"><i class="fa fa-check"></i><b>3.2.2</b> Weighting on the Propensity Score</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>4</b> NonLinear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#generalized-linear-models-glm"><i class="fa fa-check"></i><b>4.1</b> Generalized Linear Models (GLM)</a></li>
<li class="chapter" data-level="4.2" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#a-taste-of-machine-learning"><i class="fa fa-check"></i><b>4.2</b> A Taste of Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>5</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="5.1" data-path="instrumental-variables.html"><a href="instrumental-variables.html#preliminaries"><i class="fa fa-check"></i><b>5.1</b> Preliminaries</a></li>
<li class="chapter" data-level="5.2" data-path="instrumental-variables.html"><a href="instrumental-variables.html#ols-results"><i class="fa fa-check"></i><b>5.2</b> OLS results</a></li>
<li class="chapter" data-level="5.3" data-path="instrumental-variables.html"><a href="instrumental-variables.html#wald-estimator"><i class="fa fa-check"></i><b>5.3</b> Wald Estimator</a></li>
<li class="chapter" data-level="5.4" data-path="instrumental-variables.html"><a href="instrumental-variables.html#sls-estimates"><i class="fa fa-check"></i><b>5.4</b> 2SLS Estimates</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="instrumental-variables.html"><a href="instrumental-variables.html#manually-getting-the-coefficient-dont-do-it"><i class="fa fa-check"></i><b>5.4.1</b> Manually getting the coefficient (don’t do it!)</a></li>
<li class="chapter" data-level="5.4.2" data-path="instrumental-variables.html"><a href="instrumental-variables.html#the-correct-way"><i class="fa fa-check"></i><b>5.4.2</b> The correct way</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fixed-effects.html"><a href="fixed-effects.html"><i class="fa fa-check"></i><b>6</b> Fixed Effects</a>
<ul>
<li class="chapter" data-level="6.1" data-path="fixed-effects.html"><a href="fixed-effects.html#preliminaries-1"><i class="fa fa-check"></i><b>6.1</b> Preliminaries</a></li>
<li class="chapter" data-level="6.2" data-path="fixed-effects.html"><a href="fixed-effects.html#between-variation"><i class="fa fa-check"></i><b>6.2</b> Between variation</a></li>
<li class="chapter" data-level="6.3" data-path="fixed-effects.html"><a href="fixed-effects.html#within-variation"><i class="fa fa-check"></i><b>6.3</b> Within variation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-the-demeaned-values-of-y_it-on-d_it"><i class="fa fa-check"></i><b>6.3.1</b> Regress the demeaned values of <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span></a></li>
<li class="chapter" data-level="6.3.2" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-y_it-on-d_it-and-county-unit-dummies"><i class="fa fa-check"></i><b>6.3.2</b> Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> and county unit dummies</a></li>
<li class="chapter" data-level="6.3.3" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-y_it-on-d_it-with-canned-fixed-effects-routine"><i class="fa fa-check"></i><b>6.3.3</b> Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> with canned fixed effects routine</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="fixed-effects.html"><a href="fixed-effects.html#two-way-fixed-effects"><i class="fa fa-check"></i><b>6.4</b> Two-way fixed effects</a></li>
<li class="chapter" data-level="6.5" data-path="fixed-effects.html"><a href="fixed-effects.html#panel-data-alone-cant-deal-with-simultaneity"><i class="fa fa-check"></i><b>6.5</b> Panel data alone can’t deal with simultaneity</a></li>
<li class="chapter" data-level="6.6" data-path="fixed-effects.html"><a href="fixed-effects.html#intepreting-within-relationships"><i class="fa fa-check"></i><b>6.6</b> Intepreting Within Relationships</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>7</b> Difference-in-Differences</a>
<ul>
<li class="chapter" data-level="7.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#line-plots"><i class="fa fa-check"></i><b>7.1</b> Line plots</a></li>
<li class="chapter" data-level="7.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#difference-in-differences-example-cheng-and-hoekstra-2013"><i class="fa fa-check"></i><b>7.2</b> Difference-in-Differences Example: Cheng and Hoekstra (2013)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#falsification-tests"><i class="fa fa-check"></i><b>7.2.1</b> Falsification tests</a></li>
<li class="chapter" data-level="7.2.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#deterrence"><i class="fa fa-check"></i><b>7.2.2</b> Deterrence</a></li>
<li class="chapter" data-level="7.2.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#homicide-in-florida"><i class="fa fa-check"></i><b>7.2.3</b> Homicide in Florida</a></li>
<li class="chapter" data-level="7.2.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html#multistate-homicide-regression"><i class="fa fa-check"></i><b>7.2.4</b> Multistate Homicide Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="synthetic-control.html"><a href="synthetic-control.html"><i class="fa fa-check"></i><b>8</b> Synthetic Control</a>
<ul>
<li class="chapter" data-level="8.1" data-path="synthetic-control.html"><a href="synthetic-control.html#preliminaries-2"><i class="fa fa-check"></i><b>8.1</b> Preliminaries</a></li>
<li class="chapter" data-level="8.2" data-path="synthetic-control.html"><a href="synthetic-control.html#the-economic-cost-of-the-1990-german-reunification"><i class="fa fa-check"></i><b>8.2</b> The Economic Cost of the 1990 German Reunification</a></li>
<li class="chapter" data-level="8.3" data-path="synthetic-control.html"><a href="synthetic-control.html#placebo-studies"><i class="fa fa-check"></i><b>8.3</b> Placebo Studies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Econometrics of Policy Evaluation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nonlinear-regression" class="section level1" number="4">
<h1><span class="header-section-number"> 4</span> NonLinear Regression</h1>
<p><a href="https://guerramarcelino.github.io/Econ474/Lectures/Lec2/lec2?panelset6=ols-estimation2&amp;panelset7=fwl2&amp;panelset8=interpretation2&amp;panelset9=se%253A-simple-regression2&amp;panelset10=education-and-experience2&amp;panelset11=robust-standard-errors2#5">We saw how to describe relationships fitting a line through the data</a>, but that does not work always. Here, we will focus on an approach to performing regression that does not rely on a linear relationship between covariates and outcome. Specifically, we want to deal with binary dependent variables (i.e., when <span class="math inline">\(Y\)</span> takes on two values: 0 and 1). These lecture notes are based on <span class="citation"><a href="#ref-huntington2021effect" role="doc-biblioref">Huntington-Klein</a> (<a href="#ref-huntington2021effect" role="doc-biblioref">2021</a>)</span> chapter 13 (section 13.2.6).</p>
<div id="generalized-linear-models-glm" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Generalized Linear Models (GLM)</h2>
<p>To extend regression when we need to allow nonlinearity, one can leverage the generalized linear models. Instead of writing the regression model as <span class="math inline">\(Y=\beta_{0}+\beta_{1}X\)</span>, our regression equation can be written as</p>
<p><span class="math display">\[Y=F(\beta_{0}+\beta_{1}X)\]</span></p>
<p>where <span class="math inline">\(F()\)</span> is a <em>link function</em>. In this case, if <span class="math inline">\(F(x)=x\)</span>, <span class="math inline">\(Y=\beta_{0}+\beta_{1}X\)</span>, i.e., the linear regression is a specific case of the GLM.</p>
<p>If our <span class="math inline">\(Y\)</span> is a binary variable, the regression model predicts the probability that <span class="math inline">\(Y\)</span> is equal to one. So when we use a link function <span class="math inline">\(F()\)</span> that works with a binary <span class="math inline">\(Y\)</span>, we are looking for</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(F()\)</span> that takes any value from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span></li>
<li><span class="math inline">\(F()\)</span> that produces values between 0 and 1</li>
<li>Whenever the input (<span class="math inline">\(\beta_{0}+\beta_{1}X\)</span>) increases, the output should also increase</li>
</ol>
<p>Many functions satisfy these criteria, but two are frequently used: the <code>logit</code> and the <code>probit</code> link functions.</p>
<p>The <code>probit</code> function looks like</p>
<p><span class="math display">\[Pr(Y=1|X)=\Phi(\beta_{0}+\beta_{1}X)\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the cumulative distribution function (CDF) of the standard normal distribution.</p>
<p>The <code>logit</code> function is</p>
<p><span class="math display">\[F(\beta_{0}+\beta_{1}X)=\frac{e^{\beta_{0}+\beta_{1}X}}{1+e^{\beta_{0}+\beta_{1}X}}\]</span>
and we can write the logistic model as <span class="math inline">\(log(\frac{p}{1-p})=\beta_{0}+\beta_{1}X\)</span>. These two link functions produce very similar predictions. Note that the interpretation of the GLM is different from the OLS model. The most common way is to present the results of probit/logit models in terms of <strong>marginal effects</strong>, and the interpretation will be given using the <code>titanic</code> dataset.</p>
<p>For the exercise, we are going to use the <a href="https://github.com/guerramarcelino/PolicyEval/raw/main/Datasets/titanic.RDS">titanic.RDS</a> file, and you can check the variables’ description <a href="https://guerramarcelino.github.io/Econ474/Rlabs/lab4#subclassification-example">here</a>. Read the file and create a dummy that takes one if the passenger was located in the first class and 0 otherwise.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="nonlinear-regression.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="nonlinear-regression.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/User/Desktop/474-Rlab/LectureNotes/datasets&quot;</span>)</span>
<span id="cb1-3"><a href="nonlinear-regression.html#cb1-3" aria-hidden="true" tabindex="-1"></a>titanic<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;titanic.RDS&quot;</span>)</span>
<span id="cb1-4"><a href="nonlinear-regression.html#cb1-4" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>first_class<span class="ot">&lt;-</span><span class="fu">ifelse</span>(titanic<span class="sc">$</span>class<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<p>To run the logit regression, use the <code>glm()</code> function with the input <code>family = binomial(link = 'logit')</code>. The dependent variable is <code>survived</code>, which takes on one if the passenger survived and 0 otherwise. The covariates are <code>age</code>, <code>gender</code> and <code>first_class</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="nonlinear-regression.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the glm() function with</span></span>
<span id="cb2-2"><a href="nonlinear-regression.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the family = binomial(link = &#39;logit&#39;) option</span></span>
<span id="cb2-3"><a href="nonlinear-regression.html#cb2-3" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">glm</span>( survived <span class="sc">~</span> first_class<span class="sc">+</span> age<span class="sc">+</span> sex, <span class="at">data =</span> titanic,</span>
<span id="cb2-4"><a href="nonlinear-regression.html#cb2-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&#39;logit&#39;</span>))</span>
<span id="cb2-5"><a href="nonlinear-regression.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="nonlinear-regression.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># See the results</span></span>
<span id="cb2-7"><a href="nonlinear-regression.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = survived ~ first_class + age + sex, family = binomial(link = &quot;logit&quot;), 
##     data = titanic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9969  -0.6333  -0.6333   0.6829   1.8468  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   1.3372     0.2322   5.758 8.53e-09 ***
## first_class   1.2098     0.1407   8.597  &lt; 2e-16 ***
## age          -0.6996     0.2252  -3.106   0.0019 ** 
## sex          -2.1425     0.1227 -17.455  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2769.5  on 2200  degrees of freedom
## Residual deviance: 2255.3  on 2197  degrees of freedom
## AIC: 2263.3
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Although the regression output looks like the one from the <code>lm()</code>, we need to use the function <code>margins()</code> to interpret the coefficients in terms of average marginal probabilities. Run <code>install.packages("margins")</code> first if you do not have the package <code>margins</code> installed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="nonlinear-regression.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;margins&quot;) </span></span>
<span id="cb4-2"><a href="nonlinear-regression.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb4-3"><a href="nonlinear-regression.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the average marginal effect of year</span></span>
<span id="cb4-4"><a href="nonlinear-regression.html#cb4-4" aria-hidden="true" tabindex="-1"></a>reg <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="nonlinear-regression.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">margins</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">&#39;first_class&#39;</span>,<span class="st">&#39;age&#39;</span>,<span class="st">&#39;sex&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="nonlinear-regression.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##       factor     AME     SE        z      p   lower   upper
##          age -0.1164 0.0372  -3.1253 0.0018 -0.1894 -0.0434
##  first_class  0.2013 0.0223   9.0467 0.0000  0.1577  0.2449
##          sex -0.3565 0.0148 -24.0667 0.0000 -0.3856 -0.3275</code></pre>
<p>Since all the explanatory variables are dummies, it is easy to understand the marginal effects in that regression. For instance, if a passenger is located in the first class, that increases the survival probability by 20.13%. You can apply the same reasoning to interpret the average marginal effects (AME) of the dummies that represent adults and men.</p>
</div>
<div id="a-taste-of-machine-learning" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> A Taste of Machine Learning</h2>
<p>Logistic regression is frequently used for classification tasks in machine learning, and it is an excellent algorithm for binary classification. The first step is to split the dataset into training and testing samples randomly. You will fit the model using 75% of the data and test your predictions’ accuracy using the other 25%.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="nonlinear-regression.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) </span>
<span id="cb6-2"><a href="nonlinear-regression.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#creating indices</span></span>
<span id="cb6-3"><a href="nonlinear-regression.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-4"><a href="nonlinear-regression.html#cb6-4" aria-hidden="true" tabindex="-1"></a>trainIndex<span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(titanic<span class="sc">$</span>survived,<span class="at">p=</span><span class="fl">0.75</span>,<span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb6-5"><a href="nonlinear-regression.html#cb6-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-6"><a href="nonlinear-regression.html#cb6-6" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="ot">&lt;-</span> titanic[trainIndex,] <span class="co">#training data (75% of data)</span></span>
<span id="cb6-7"><a href="nonlinear-regression.html#cb6-7" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="ot">&lt;-</span> titanic[<span class="sc">-</span>trainIndex,] <span class="co">#testing data (25% of data)</span></span></code></pre></div>
<p>Run the model with the <code>titanic_train</code> dataset.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="nonlinear-regression.html#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> first_class<span class="sc">+</span>age<span class="sc">+</span>sex, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&#39;logit&#39;</span>), <span class="at">data=</span>titanic_train)</span>
<span id="cb7-2"><a href="nonlinear-regression.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = survived ~ first_class + age + sex, family = binomial(link = &quot;logit&quot;), 
##     data = titanic_train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9788  -0.6566  -0.6566   0.9043   1.8113  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   1.3884     0.2649   5.242 1.59e-07 ***
## first_class   1.1225     0.1606   6.990 2.74e-12 ***
## age          -0.7054     0.2561  -2.754  0.00588 ** 
## sex          -2.1079     0.1418 -14.863  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2102.7  on 1650  degrees of freedom
## Residual deviance: 1730.8  on 1647  degrees of freedom
## AIC: 1738.8
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Then, get the predicted probability for passenger’s survival according to the explanatory variables <code>age</code>, <code>sex</code>, and <code>first_class</code>. Let’s set the threshold at 0.5 - i.e., if the predicted probability is higher than 50%, we consider that the passenger survived. After that, display the confusion matrix: a 2x2 matrix that shows how the model classified each passenger in the testing sample <em>vs.</em> what happened with those passengers in reality.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="nonlinear-regression.html#cb9-1" aria-hidden="true" tabindex="-1"></a>probs<span class="ot">&lt;-</span><span class="fu">predict</span>(model, titanic_test, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb9-2"><a href="nonlinear-regression.html#cb9-2" aria-hidden="true" tabindex="-1"></a>preds<span class="ot">&lt;-</span><span class="fu">ifelse</span>(probs<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb9-3"><a href="nonlinear-regression.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(preds), <span class="fu">factor</span>(titanic_test<span class="sc">$</span>survived))</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   0   1
##          0 356  75
##          1  34  85
##                                          
##                Accuracy : 0.8018         
##                  95% CI : (0.766, 0.8343)
##     No Information Rate : 0.7091         
##     P-Value [Acc &gt; NIR] : 4.471e-07      
##                                          
##                   Kappa : 0.4804         
##                                          
##  Mcnemar&#39;s Test P-Value : 0.0001275      
##                                          
##             Sensitivity : 0.9128         
##             Specificity : 0.5312         
##          Pos Pred Value : 0.8260         
##          Neg Pred Value : 0.7143         
##              Prevalence : 0.7091         
##          Detection Rate : 0.6473         
##    Detection Prevalence : 0.7836         
##       Balanced Accuracy : 0.7220         
##                                          
##        &#39;Positive&#39; Class : 0              
## </code></pre>
<p><strong>Overall, the model is correct around 80% of the time.</strong></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-huntington2021effect" class="csl-entry">
Huntington-Klein, Nick. 2021. <em>The Effect: An Introduction to Research Design and Causality</em>. Chapman; Hall/CRC.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="subclassification-and-matching.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="instrumental-variables.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-NonLinearRegression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
