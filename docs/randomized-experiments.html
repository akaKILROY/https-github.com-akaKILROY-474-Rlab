<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 1 Randomized Experiments | Econometrics of Policy Evaluation</title>
  <meta name="description" content="ECON 474 R-lab notes" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content=" 1 Randomized Experiments | Econometrics of Policy Evaluation" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://guerramarcelino.github.io/Econ474/474-Rlabs/" />
  
  <meta property="og:description" content="ECON 474 R-lab notes" />
  <meta name="github-repo" content="guerramarcelino/474-Rlab" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 1 Randomized Experiments | Econometrics of Policy Evaluation" />
  
  <meta name="twitter:description" content="ECON 474 R-lab notes" />
  

<meta name="author" content="Ben Cizek, Alex Costa, Marcelino Guerra, Mingqian Liu" />


<meta name="date" content="2022-02-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="inference-review.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECON 474 @UIUC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="randomized-experiments.html"><a href="randomized-experiments.html"><i class="fa fa-check"></i><b>1</b> Randomized Experiments</a>
<ul>
<li class="chapter" data-level="1.1" data-path="randomized-experiments.html"><a href="randomized-experiments.html#rand-health-insurance-experiment"><i class="fa fa-check"></i><b>1.1</b> RAND Health Insurance Experiment</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="randomized-experiments.html"><a href="randomized-experiments.html#working-with-.rds-files"><i class="fa fa-check"></i><b>1.1.1</b> Working with .RDS files</a></li>
<li class="chapter" data-level="1.1.2" data-path="randomized-experiments.html"><a href="randomized-experiments.html#summarizing-data"><i class="fa fa-check"></i><b>1.1.2</b> Summarizing data</a></li>
<li class="chapter" data-level="1.1.3" data-path="randomized-experiments.html"><a href="randomized-experiments.html#checking-for-balance"><i class="fa fa-check"></i><b>1.1.3</b> Checking for Balance</a></li>
<li class="chapter" data-level="1.1.4" data-path="randomized-experiments.html"><a href="randomized-experiments.html#results-of-the-experiment"><i class="fa fa-check"></i><b>1.1.4</b> Results of the Experiment</a></li>
<li class="chapter" data-level="1.1.5" data-path="randomized-experiments.html"><a href="randomized-experiments.html#equivalence-of-differences-in-means-and-regression"><i class="fa fa-check"></i><b>1.1.5</b> Equivalence of Differences in Means and Regression</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="randomized-experiments.html"><a href="randomized-experiments.html#ab-testing"><i class="fa fa-check"></i><b>1.2</b> A/B Testing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="inference-review.html"><a href="inference-review.html"><i class="fa fa-check"></i><b>2</b> Inference Review</a>
<ul>
<li class="chapter" data-level="2.1" data-path="inference-review.html"><a href="inference-review.html#flipping-coins"><i class="fa fa-check"></i><b>2.1</b> Flipping coins</a></li>
<li class="chapter" data-level="2.2" data-path="inference-review.html"><a href="inference-review.html#sample-mean"><i class="fa fa-check"></i><b>2.2</b> Sample mean</a></li>
<li class="chapter" data-level="2.3" data-path="inference-review.html"><a href="inference-review.html#measuring-variability"><i class="fa fa-check"></i><b>2.3</b> Measuring Variability</a></li>
<li class="chapter" data-level="2.4" data-path="inference-review.html"><a href="inference-review.html#central-limit-theorem-clt"><i class="fa fa-check"></i><b>2.4</b> Central Limit Theorem (CLT)</a></li>
<li class="chapter" data-level="2.5" data-path="inference-review.html"><a href="inference-review.html#the-t-statistic-and-the-clt"><i class="fa fa-check"></i><b>2.5</b> The t-Statistic and the CLT</a></li>
<li class="chapter" data-level="2.6" data-path="inference-review.html"><a href="inference-review.html#confidence-interval"><i class="fa fa-check"></i><b>2.6</b> Confidence Interval</a></li>
<li class="chapter" data-level="2.7" data-path="inference-review.html"><a href="inference-review.html#hypothesis-testing"><i class="fa fa-check"></i><b>2.7</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html"><i class="fa fa-check"></i><b>3</b> Subclassification and Matching</a>
<ul>
<li class="chapter" data-level="3.1" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#subclassification-example"><i class="fa fa-check"></i><b>3.1</b> Subclassification Example</a></li>
<li class="chapter" data-level="3.2" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#propensity-score-example"><i class="fa fa-check"></i><b>3.2</b> Propensity Score Example</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#nearest-neighbor-matching"><i class="fa fa-check"></i><b>3.2.1</b> Nearest-Neighbor Matching</a></li>
<li class="chapter" data-level="3.2.2" data-path="subclassification-and-matching.html"><a href="subclassification-and-matching.html#weighting-on-the-propensity-score"><i class="fa fa-check"></i><b>3.2.2</b> Weighting on the Propensity Score</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>4</b> NonLinear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#generalized-linear-models-glm"><i class="fa fa-check"></i><b>4.1</b> Generalized Linear Models (GLM)</a></li>
<li class="chapter" data-level="4.2" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html#a-taste-of-machine-learning"><i class="fa fa-check"></i><b>4.2</b> A Taste of Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>5</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="5.1" data-path="instrumental-variables.html"><a href="instrumental-variables.html#preliminaries"><i class="fa fa-check"></i><b>5.1</b> Preliminaries</a></li>
<li class="chapter" data-level="5.2" data-path="instrumental-variables.html"><a href="instrumental-variables.html#ols-results"><i class="fa fa-check"></i><b>5.2</b> OLS results</a></li>
<li class="chapter" data-level="5.3" data-path="instrumental-variables.html"><a href="instrumental-variables.html#wald-estimator"><i class="fa fa-check"></i><b>5.3</b> Wald Estimator</a></li>
<li class="chapter" data-level="5.4" data-path="instrumental-variables.html"><a href="instrumental-variables.html#sls-estimates"><i class="fa fa-check"></i><b>5.4</b> 2SLS Estimates</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="instrumental-variables.html"><a href="instrumental-variables.html#manually-getting-the-coefficient-dont-do-it"><i class="fa fa-check"></i><b>5.4.1</b> Manually getting the coefficient (don’t do it!)</a></li>
<li class="chapter" data-level="5.4.2" data-path="instrumental-variables.html"><a href="instrumental-variables.html#the-correct-way"><i class="fa fa-check"></i><b>5.4.2</b> The correct way</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fixed-effects.html"><a href="fixed-effects.html"><i class="fa fa-check"></i><b>6</b> Fixed Effects</a>
<ul>
<li class="chapter" data-level="6.1" data-path="fixed-effects.html"><a href="fixed-effects.html#preliminaries-1"><i class="fa fa-check"></i><b>6.1</b> Preliminaries</a></li>
<li class="chapter" data-level="6.2" data-path="fixed-effects.html"><a href="fixed-effects.html#between-variation"><i class="fa fa-check"></i><b>6.2</b> Between variation</a></li>
<li class="chapter" data-level="6.3" data-path="fixed-effects.html"><a href="fixed-effects.html#within-variation"><i class="fa fa-check"></i><b>6.3</b> Within variation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-the-demeaned-values-of-y_it-on-d_it"><i class="fa fa-check"></i><b>6.3.1</b> Regress the demeaned values of <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span></a></li>
<li class="chapter" data-level="6.3.2" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-y_it-on-d_it-and-county-unit-dummies"><i class="fa fa-check"></i><b>6.3.2</b> Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> and county unit dummies</a></li>
<li class="chapter" data-level="6.3.3" data-path="fixed-effects.html"><a href="fixed-effects.html#regress-y_it-on-d_it-with-canned-fixed-effects-routine"><i class="fa fa-check"></i><b>6.3.3</b> Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> with canned fixed effects routine</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="fixed-effects.html"><a href="fixed-effects.html#two-way-fixed-effects"><i class="fa fa-check"></i><b>6.4</b> Two-way fixed effects</a></li>
<li class="chapter" data-level="6.5" data-path="fixed-effects.html"><a href="fixed-effects.html#panel-data-alone-cant-deal-with-simultaneity"><i class="fa fa-check"></i><b>6.5</b> Panel data alone can’t deal with simultaneity</a></li>
<li class="chapter" data-level="6.6" data-path="fixed-effects.html"><a href="fixed-effects.html#intepreting-within-relationships"><i class="fa fa-check"></i><b>6.6</b> Intepreting Within Relationships</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>7</b> Difference-in-Differences</a>
<ul>
<li class="chapter" data-level="7.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#line-plots"><i class="fa fa-check"></i><b>7.1</b> Line plots</a></li>
<li class="chapter" data-level="7.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#difference-in-differences-example-cheng-and-hoekstra-2013"><i class="fa fa-check"></i><b>7.2</b> Difference-in-Differences Example: Cheng and Hoekstra (2013)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#falsification-tests"><i class="fa fa-check"></i><b>7.2.1</b> Falsification tests</a></li>
<li class="chapter" data-level="7.2.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#deterrence"><i class="fa fa-check"></i><b>7.2.2</b> Deterrence</a></li>
<li class="chapter" data-level="7.2.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#homicide-in-florida"><i class="fa fa-check"></i><b>7.2.3</b> Homicide in Florida</a></li>
<li class="chapter" data-level="7.2.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html#multistate-homicide-regression"><i class="fa fa-check"></i><b>7.2.4</b> Multistate Homicide Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="synthetic-control.html"><a href="synthetic-control.html"><i class="fa fa-check"></i><b>8</b> Synthetic Control</a>
<ul>
<li class="chapter" data-level="8.1" data-path="synthetic-control.html"><a href="synthetic-control.html#preliminaries-2"><i class="fa fa-check"></i><b>8.1</b> Preliminaries</a></li>
<li class="chapter" data-level="8.2" data-path="synthetic-control.html"><a href="synthetic-control.html#the-economic-cost-of-the-1990-german-reunification"><i class="fa fa-check"></i><b>8.2</b> The Economic Cost of the 1990 German Reunification</a></li>
<li class="chapter" data-level="8.3" data-path="synthetic-control.html"><a href="synthetic-control.html#placebo-studies"><i class="fa fa-check"></i><b>8.3</b> Placebo Studies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Econometrics of Policy Evaluation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="randomized-experiments" class="section level1" number="1">
<h1><span class="header-section-number"> 1</span> Randomized Experiments</h1>
<div id="rand-health-insurance-experiment" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> RAND Health Insurance Experiment</h2>
<div id="working-with-.rds-files" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Working with .RDS files</h3>
<p>The first step is to set up your working directory. To better organize things, you can create a folder named <code>Rlabs</code> on your desktop. Inside of it, you might want to have different folders for each <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> lab - in this case, <code>lab1</code>. To change the working directory, use <code>setwd()</code> with the path that leads to the folder you want, or press <code>ctrl+shift+h</code> and find the preferred folder.</p>
<p>In this lab, we will use data from the RAND Health Insurance Experiment (HIE), and there are two datasets. <a href="https://github.com/guerramarcelino/PolicyEval/raw/main/Datasets/rand_sample.RDS">Here</a> you have demographic information about the subjects in the study and also health variables (outcomes) both before and after the experiment. The other file (<a href="https://github.com/guerramarcelino/PolicyEval/raw/main/Datasets/rand_spend.RDS">here</a>) has information about health care spending. These notes are heavily based on <span class="citation"><a href="#ref-angrist2014mastering" role="doc-biblioref">Angrist and Pischke</a> (<a href="#ref-angrist2014mastering" role="doc-biblioref">2014</a>)</span> chapter 1, and <a href="https://guerramarcelino.github.io/Econ474/Lectures/Lec1/lec1?panelset1=lln2#11">here</a> you have a summary of the RAND HIE.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="randomized-experiments.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/User/Desktop/474-Rlab/datasets&quot;</span>)</span>
<span id="cb1-2"><a href="randomized-experiments.html#cb1-2" aria-hidden="true" tabindex="-1"></a>rand_sample<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;rand_sample.RDS&quot;</span>)</span>
<span id="cb1-3"><a href="randomized-experiments.html#cb1-3" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;rand_spend.RDS&quot;</span>)</span></code></pre></div>
<p>If you want to see the first values on that dataset, you can use the function head() or use <code>View(rand_sample)</code> to open the dataframe in a new tab.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="randomized-experiments.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#View(rand_sample)</span></span>
<span id="cb2-2"><a href="randomized-experiments.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rand_sample,<span class="dv">5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="randomized-experiments.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(rand_spend)</span>
<span id="cb3-2"><a href="randomized-experiments.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#head(rand_spend,5)</span></span></code></pre></div>
<style>
div.blue { background-color:#AAB7B8; border-radius: 5px; padding: 20px;}
</style>
<div class="blue">
<p>Another way to check the dataset is using the function <code>glimpse()</code>, using tidyverse. Then you have a good look at all the 319 columns in this dataset.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="randomized-experiments.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="randomized-experiments.html#cb4-2" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="sc">%&gt;%</span><span class="fu">glimpse</span>()</span></code></pre></div>
</div>
<p><br></p>
<p>Besides the column <code>plantype</code>, which identifies the assigned insurance group of each individual, the variables that we are looking for are displayed in <a href="randomized-experiments.html#tab:tab1">1.1</a>:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tab1">Table 1.1: </span>Variables Description
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Definition
</th>
</tr>
</thead>
<tbody>
<tr grouplength="14">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>rand_sample file</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
female
</td>
<td style="text-align:left;width: 12cm; ">
Female
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
blackhisp
</td>
<td style="text-align:left;width: 12cm; ">
Nonwhite
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
age
</td>
<td style="text-align:left;width: 12cm; ">
Age
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
educper
</td>
<td style="text-align:left;width: 12cm; ">
Education
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
income1cpi
</td>
<td style="text-align:left;width: 12cm; ">
Family Income
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
hosp
</td>
<td style="text-align:left;width: 12cm; ">
Hospitalized last year
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ghindx
</td>
<td style="text-align:left;width: 12cm; ">
General Health Index (before)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
cholest
</td>
<td style="text-align:left;width: 12cm; ">
Cholesterol (mg/dl) (before)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
systol
</td>
<td style="text-align:left;width: 12cm; ">
Systolic blood pressure (mm Hg) (before)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
mhi
</td>
<td style="text-align:left;width: 12cm; ">
Mental Health Index (before)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ghindxx
</td>
<td style="text-align:left;width: 12cm; ">
General Health Index (after)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
cholestx
</td>
<td style="text-align:left;width: 12cm; ">
Cholesterol (mg/dl) (after)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
systolx
</td>
<td style="text-align:left;width: 12cm; ">
Systolic blood pressure (mm Hg) (after)
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
mhix
</td>
<td style="text-align:left;width: 12cm; ">
Mental Health Index (after)
</td>
</tr>
<tr grouplength="5">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>rand_spend file</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
ftf
</td>
<td style="text-align:left;width: 12cm; ">
Face-to-face visits
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
out_inf
</td>
<td style="text-align:left;width: 12cm; ">
Outpatient expenses
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
totadm
</td>
<td style="text-align:left;width: 12cm; ">
Hospital admissions
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
inpdol_inf
</td>
<td style="text-align:left;width: 12cm; ">
Inpatient expenses
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
tot_inf
</td>
<td style="text-align:left;width: 12cm; ">
Total expenses
</td>
</tr>
</tbody>
</table>
<p>Using the function <code>select()</code>, you can focus only on the columns you will be using in this exercise:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="randomized-experiments.html#cb5-1" aria-hidden="true" tabindex="-1"></a>rand_sample<span class="ot">&lt;-</span>rand_sample<span class="sc">%&gt;%</span><span class="fu">select</span>(person, plantype, female, blackhisp,age,educper,</span>
<span id="cb5-2"><a href="randomized-experiments.html#cb5-2" aria-hidden="true" tabindex="-1"></a>                                  income1cpi,hosp,ghindx,cholest,systol,</span>
<span id="cb5-3"><a href="randomized-experiments.html#cb5-3" aria-hidden="true" tabindex="-1"></a>                                  mhi,ghindxx,cholestx,systolx,mhix)</span>
<span id="cb5-4"><a href="randomized-experiments.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="randomized-experiments.html#cb5-5" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="ot">&lt;-</span>rand_spend<span class="sc">%&gt;%</span><span class="fu">select</span>(person,plantype ,ftf,out_inf,totadm,inpdol_inf,tot_inf)</span></code></pre></div>
</div>
<div id="summarizing-data" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Summarizing data</h3>
<p>Let’s say you want to compare demographic characteristics of the individuals in the RAND HIE across health insurance groups. To do that, you just need the functions <code>group_by()</code> and <code>summarize()</code> from the <code>tidyverse</code> package. Since there are some missing observations (NA), allow the function mean() to ignore those NAs.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="randomized-experiments.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="randomized-experiments.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="randomized-experiments.html#cb6-3" aria-hidden="true" tabindex="-1"></a>rand_sample<span class="sc">%&gt;%</span><span class="fu">group_by</span>(plantype)<span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="randomized-experiments.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="at">Female=</span><span class="fu">mean</span>(female, <span class="at">na.rm=</span>T), </span>
<span id="cb6-5"><a href="randomized-experiments.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">Nonwhite=</span><span class="fu">mean</span>(blackhisp, <span class="at">na.rm=</span>T),                    </span>
<span id="cb6-6"><a href="randomized-experiments.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">Age=</span><span class="fu">mean</span>(age, <span class="at">na.rm=</span>T), </span>
<span id="cb6-7"><a href="randomized-experiments.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">Education=</span><span class="fu">mean</span>(educper, <span class="at">na.rm=</span>T), </span>
<span id="cb6-8"><a href="randomized-experiments.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Family Income</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(income1cpi, <span class="at">na.rm=</span>T),</span>
<span id="cb6-9"><a href="randomized-experiments.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Hospitalized last year</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(hosp, <span class="at">na.rm=</span>T), </span>
<span id="cb6-10"><a href="randomized-experiments.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">General Health Index</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(ghindx, <span class="at">na.rm=</span>T),</span>
<span id="cb6-11"><a href="randomized-experiments.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Cholesterol (mg/dl)</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(cholest, <span class="at">na.rm=</span>T),</span>
<span id="cb6-12"><a href="randomized-experiments.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Systolic blood pressure (mm Hg)</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(systol, <span class="at">na.rm=</span>T),</span>
<span id="cb6-13"><a href="randomized-experiments.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Mental Health Index</span><span class="st">`</span><span class="ot">=</span><span class="fu">mean</span>(mhi, <span class="at">na.rm=</span>T),</span>
<span id="cb6-14"><a href="randomized-experiments.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Number enrolled</span><span class="st">`</span><span class="ot">=</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 4 x 12
##   plantype     Female Nonwhite   Age Education `Family Income` `Hospitalized last year`
##   &lt;fct&gt;         &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;           &lt;dbl&gt;                    &lt;dbl&gt;
## 1 Catastrophic  0.560    0.172  32.4      12.1          31603.                    0.115
## 2 Deductible    0.537    0.153  32.9      11.9          29499.                    0.120
## 3 Coinsurance   0.535    0.145  33.3      12.0          32573.                    0.113
## 4 Free          0.522    0.144  32.8      11.8          30627.                    0.116
## # ... with 5 more variables: General Health Index &lt;dbl&gt;, Cholesterol (mg/dl) &lt;dbl&gt;,
## #   Systolic blood pressure (mm Hg) &lt;dbl&gt;, Mental Health Index &lt;dbl&gt;,
## #   Number enrolled &lt;int&gt;</code></pre>
<p>You can see that those values are the same as the ones in the lecture notes.</p>
</div>
<div id="checking-for-balance" class="section level3" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Checking for Balance</h3>
<p>Although you can see the average values of demographic characteristics, we are unsure whether the difference in means across groups is statistically different from zero. We can perform a standard t-test comparing two groups. In this example, we compare the Catastrophic with the free plan. Let’s try education first:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="randomized-experiments.html#cb8-1" aria-hidden="true" tabindex="-1"></a>cat_vs_free<span class="ot">&lt;-</span>rand_sample<span class="sc">%&gt;%</span><span class="fu">filter</span>(plantype<span class="sc">==</span><span class="st">&quot;Catastrophic&quot;</span><span class="sc">|</span>plantype<span class="sc">==</span><span class="st">&quot;Free&quot;</span>)</span>
<span id="cb8-2"><a href="randomized-experiments.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="randomized-experiments.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(educper<span class="sc">~</span>plantype, <span class="at">data=</span>cat_vs_free, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  educper by plantype
## t = 1.8039, df = 1478.5, p-value = 0.07145
## alternative hypothesis: true difference in means between group Catastrophic and group Free is not equal to 0
## 95 percent confidence interval:
##  -0.02296019  0.54840275
## sample estimates:
## mean in group Catastrophic         mean in group Free 
##                   12.10483                   11.84211</code></pre>
<p>According to the t-test, the difference of <span class="math inline">\(12.10483-11.84211=0.2627\)</span> is not statistically significant at the 5% level, and we do not reject the null of equal means between groups.</p>
<p>What about family income?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="randomized-experiments.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(income1cpi<span class="sc">~</span>plantype, <span class="at">data=</span>cat_vs_free, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  income1cpi by plantype
## t = 1.1661, df = 1431, p-value = 0.2438
## alternative hypothesis: true difference in means between group Catastrophic and group Free is not equal to 0
## 95 percent confidence interval:
##  -665.9016 2618.2711
## sample estimates:
## mean in group Catastrophic         mean in group Free 
##                   31603.21                   30627.02</code></pre>
<p>Again, the p-value is higher than 0.05, and we cannot reject the null: there is no evidence that family income is different between the Catastrophic and the Free insurance groups.</p>
<p><strong>As an exercise, try to compare all the demographic characteristics between insurance levels. Use Catastrophic as “control” and Deductible, Coinsurance and Free as “treatment” - do it using pairwise comparisons, e.g., Catastrophic x Deductible, Catastrophic x Coinsurance, and so on.</strong></p>
</div>
<div id="results-of-the-experiment" class="section level3" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Results of the Experiment</h3>
<p>As we saw in class, subjects assigned to more generous insurance plans used substantially more health care. Let’s compare outpatient expenses and face-to-face visits between the Catastrophic group and <strong>the other groups together (we call it <code>any_ins</code>)</strong>.</p>
<p>The <code>ifelse()</code> function helps you to assemble all groups that are different from Catastrophic in only group - <code>Any Insurance</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="randomized-experiments.html#cb12-1" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="sc">$</span>any_ins<span class="ot">&lt;-</span><span class="fu">ifelse</span>(rand_spend<span class="sc">$</span>plantype<span class="sc">==</span><span class="st">&quot;Catastrophic&quot;</span>, <span class="st">&quot;Catastrophic&quot;</span>,<span class="st">&quot;Any Insurance&quot;</span>)</span></code></pre></div>
<p>In this case, you are creating a new column in the dataset called <code>any_ins</code>. The first input is <code>rand_spend$plantype=="Catastrophic"</code>. That means for all individuals with Catastrophic plan, write <code>Catastrophic</code>. Otherwise, write <code>Any Insurance</code>. The same can be done with the <code>mutate()</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="randomized-experiments.html#cb13-1" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="ot">&lt;-</span>rand_spend<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="randomized-experiments.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">any_ins2=</span><span class="fu">ifelse</span>(rand_spend<span class="sc">$</span>plantype<span class="sc">==</span><span class="st">&quot;Catastrophic&quot;</span>, <span class="st">&quot;Catastrophic&quot;</span>,<span class="st">&quot;Any Insurance&quot;</span>))</span></code></pre></div>
<p>You can check whether <code>any_ins</code> and <code>any_ins2</code> gives you the same result:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="randomized-experiments.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(rand_spend<span class="sc">$</span>any_ins<span class="sc">==</span>rand_spend<span class="sc">$</span>any_ins2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Running the <code>t.test()</code> to check if there are differences in face-to-face visits between groups:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="randomized-experiments.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(ftf<span class="sc">~</span>any_ins, <span class="at">data=</span>rand_spend,<span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  ftf by any_ins
## t = 8.6922, df = 6290.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group Any Insurance and group Catastrophic is not equal to 0
## 95 percent confidence interval:
##  0.6961629 1.1016118
## sample estimates:
## mean in group Any Insurance  mean in group Catastrophic 
##                    3.682990                    2.784103</code></pre>
<p>The almost zero p-value gives us confidence that the difference in face-to-face visits between those with some insurance and the Catastrophic group is statistically significant. One can see the same for outpatient expenses below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="randomized-experiments.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(out_inf<span class="sc">~</span>any_ins, <span class="at">data=</span>rand_spend, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  out_inf by any_ins
## t = 10.992, df = 6274.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group Any Insurance and group Catastrophic is not equal to 0
## 95 percent confidence interval:
##   82.67062 118.56030
## sample estimates:
## mean in group Any Insurance  mean in group Catastrophic 
##                    348.4137                    247.7983</code></pre>
</div>
<div id="equivalence-of-differences-in-means-and-regression" class="section level3" number="1.1.5">
<h3><span class="header-section-number">1.1.5</span> Equivalence of Differences in Means and Regression</h3>
<p>Instead of performing a t-test for differences in means, one can run regressions and get the same results. Regression plays an important role in empirical economic research and can be easily applied to experimental data. The advantage is that you can add controls and fix standard errors (we will talk about that later).</p>
<p>Let’s first create a dummy that is equal to 1 if the individual has “any insurance” (i.e., is assigned to the Deductible, Coinsurance, or Free group) and zero otherwise:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="randomized-experiments.html#cb20-1" aria-hidden="true" tabindex="-1"></a>rand_spend<span class="sc">$</span>dummy_ins<span class="ot">&lt;-</span><span class="fu">ifelse</span>(rand_spend<span class="sc">$</span>any_ins<span class="sc">==</span><span class="st">&quot;Any Insurance&quot;</span>, <span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<p>Then, use the <code>lm()</code> to perform a linear regression of Face-to-face visits on the dummy that identifies the comparison groups:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="randomized-experiments.html#cb21-1" aria-hidden="true" tabindex="-1"></a>reg1<span class="ot">&lt;-</span><span class="fu">lm</span>(ftf<span class="sc">~</span>dummy_ins, <span class="at">data=</span>rand_spend)</span>
<span id="cb21-2"><a href="randomized-experiments.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ftf ~ dummy_ins, data = rand_spend)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
##  -3.683  -2.784  -1.683   0.317 140.317 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.7841     0.1036  26.876  &lt; 2e-16 ***
## dummy_ins     0.8989     0.1147   7.837 4.85e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.322 on 20201 degrees of freedom
## Multiple R-squared:  0.003031,   Adjusted R-squared:  0.002982 
## F-statistic: 61.42 on 1 and 20201 DF,  p-value: 4.849e-15</code></pre>
<p>The coefficient <code>0.8989</code> represents the difference in face-to-face visits between the insurance groups. As one can see, the coefficient is statistically significant (p-value&lt;0.05).</p>
<p>When you perform the t-test for difference in means with the option <code>var.equal=TRUE</code> (i.e., assuming equal variance), you get the same standard errors/p-value/t statistic. Notice that running the standard OLS, you assume homoskedasticity, and that is why you need to set <code>var.equal=TRUE</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="randomized-experiments.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(ftf<span class="sc">~</span>any_ins, <span class="at">data=</span>rand_spend,<span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  ftf by any_ins
## t = 7.8368, df = 20201, p-value = 4.849e-15
## alternative hypothesis: true difference in means between group Any Insurance and group Catastrophic is not equal to 0
## 95 percent confidence interval:
##  0.6740646 1.1237101
## sample estimates:
## mean in group Any Insurance  mean in group Catastrophic 
##                    3.682990                    2.784103</code></pre>
<p>Doing the same for <strong>outpatient expenses</strong>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="randomized-experiments.html#cb25-1" aria-hidden="true" tabindex="-1"></a>reg2<span class="ot">&lt;-</span><span class="fu">lm</span>(out_inf<span class="sc">~</span>dummy_ins, <span class="at">data=</span>rand_spend)</span>
<span id="cb25-2"><a href="randomized-experiments.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = out_inf ~ dummy_ins, data = rand_spend)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
##  -348.4  -290.3  -175.5    69.2 12527.1 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  247.798      9.153  27.073   &lt;2e-16 ***
## dummy_ins    100.615     10.135   9.928   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 558.6 on 20201 degrees of freedom
## Multiple R-squared:  0.004855,   Adjusted R-squared:  0.004806 
## F-statistic: 98.56 on 1 and 20201 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="randomized-experiments.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(out_inf<span class="sc">~</span>any_ins, <span class="at">data=</span>rand_spend, <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  out_inf by any_ins
## t = 9.9278, df = 20201, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group Any Insurance and group Catastrophic is not equal to 0
## 95 percent confidence interval:
##   80.75058 120.48034
## sample estimates:
## mean in group Any Insurance  mean in group Catastrophic 
##                    348.4137                    247.7983</code></pre>
<p><strong>What about the health outcomes?</strong> Compare the average health outcomes after the experiment - <code>ghindxx</code>, <code>cholestx</code>, <code>systolx</code>, <code>mhix</code> - between the Catastrophic and any insurance groups using regression. Do you see any statistically significant coefficient?</p>
</div>
</div>
<div id="ab-testing" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> A/B Testing</h2>
<p>A/B tests are heavily used in industry. Companies run thousands of experiments every year, sometimes involving millions of customers to test changes in user experience, the relevance of algorithms, etc. (see some examples <a href="https://guerramarcelino.github.io/Econ474/Lectures/Lec1/lec1#19">here</a>). Before you start designing those experiments, you need to understand some basic concepts related to hypothesis testing<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>For now, let’s talk about possible results when conducting a test. Say you want to check customer engagement in the <a href="https://active.illinois.edu/">Active Illini</a> website. To participate in Intramural Activities, students must pay a $50 fee. The user needs to click on the “Memberships” box in the middle of the homepage at the bottom left and follow some instructions. Working as a data scientist at Campus Recreation, you suggest placing the “Memberships” at the top left instead to see whether this causes an increase in intramural memberships. <strong>The experimental unit is user</strong>: some will be randomly selected to see the “Memberships” box at the top left, others will see the current version (at the bottom left). You get the mean of intramural memberships in each group and then compare those values, testing the following:</p>
<span class="math display">\[\begin{array}{rcl}
    H_{o} &amp; \mu_{1}=\mu_{0}   \\
    H_{a} &amp; \mu_{1}\neq \mu_{0}      
\end{array}\]</span>
<p>where <span class="math inline">\(\mu_{1}\)</span> is the average number of intramural memberships in the treated group, and <span class="math inline">\(\mu_{0}\)</span> is the average number of intramural memberships in the control group. Conducting this kind of test, you have four possible outcomes:</p>
<ol style="list-style-type: decimal">
<li><p>If the null hypothesis is false and the statistical test leads us to reject it, you’ve made a correct decision. You’ve correctly determined that intramural memberships are affected by the box position.</p></li>
<li><p>If the null hypothesis is true and you don’t reject it, you’ve made a correct decision. There is no difference between having the box at the top left or at the bottom left.</p></li>
<li><p>If the null hypothesis is true, but you reject it, you’ve committed a Type I error. You’ve concluded that the box position affects intramural memberships when it doesn’t.</p></li>
<li><p>If the null hypothesis is false and you fail to reject it, you’ve committed a Type II error. Box position affects intramural memberships, but you’ve been unable to discern this.</p></li>
</ol>
<p>These outcomes are illustrated below:</p>
<table>
<thead>
<tr class="header">
<th align="center"></th>
<th align="center"><strong>Fail to Reject <span class="math inline">\(H_{0}\)</span></strong></th>
<th align="center"><strong>Reject <span class="math inline">\(H_{0}\)</span></strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(H_{0}\)</span> is true</td>
<td align="center">Good decision <span class="math inline">\((Prob=1-\alpha)\)</span></td>
<td align="center">Type I error <span class="math inline">\((Prob=\alpha)\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(H_{a}\)</span> is true</td>
<td align="center">Type II error <span class="math inline">\((Prob=\beta)\)</span></td>
<td align="center">Good decision <span class="math inline">\((Prob=1-\beta)\)</span></td>
</tr>
</tbody>
</table>
<p>We would like to have a good power <span class="math inline">\((1-\beta\text{, usually 80%})\)</span> - i.e., to be able to detect an effect if there is a true effect to be detected. In that sense, power analysis is an important aspect of experimental design - it allows us to determine the minimum sample size to detect an effect of a given size with a certain degree of confidence. For simple experiments, the <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> package <code>pwr</code> can be used to perform power analysis.</p>
<p>For example, to compute the sample size required to reach a good power in the intramural memberships experiment, we can use the following:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="randomized-experiments.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install it first using install.packages(&quot;pwr&quot;) </span></span>
<span id="cb29-2"><a href="randomized-experiments.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pwr)</span>
<span id="cb29-3"><a href="randomized-experiments.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.t.test</span>(<span class="at">d=</span><span class="fl">0.2</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>, <span class="at">power=</span><span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 393.4057
##               d = 0.2
##       sig.level = 0.05
##           power = 0.8
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<p>For each group, we would need 394 users. In total, the sample size would be 788 users. The necessary ingredients to cook the required sample size are <em>i)</em> d <em>ii)</em> <span class="math inline">\(\alpha=0.05\)</span>, and <em>iii)</em> <span class="math inline">\(power=0.8\)</span>. The first input <span class="math inline">\(d\)</span> is the effect size - a standardized measure of the difference you are trying to detect. In other words, you want to be able to detect a difference of 0.2 (a change that would be considered important for Campus Recreation) with a probability of 0.8.</p>
<p>Now, let’s say you only had 92 users in each group accessing the Active Illini website during the last two weeks. Is 92 x 2 a large enough sample for your experiment?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="randomized-experiments.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install it first using </span></span>
<span id="cb31-2"><a href="randomized-experiments.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;pwr&quot;) </span></span>
<span id="cb31-3"><a href="randomized-experiments.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pwr)</span>
<span id="cb31-4"><a href="randomized-experiments.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.t.test</span>(<span class="at">d=</span><span class="fl">0.2</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>, <span class="at">n=</span><span class="dv">92</span>)</span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 92
##               d = 0.2
##       sig.level = 0.05
##           power = 0.2711829
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<p>The power of this test is only 27.11%. You probably won’t detect that small effect <span class="math inline">\((d=0.2)\)</span> with so few people in each group. One alternative is to keep running the experiment until you reach 394 users per group.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-angrist2014mastering" class="csl-entry">
Angrist, Joshua D, and Jörn-Steffen Pischke. 2014. <em>Mastering Metrics: The Path from Cause to Effect</em>. Princeton university press.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>In chapter 2, we provide an extensive review of inference.<a href="randomized-experiments.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inference-review.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-Randomization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
